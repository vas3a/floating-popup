// Generated by CoffeeScript 1.7.1
(function() {
  (function(doc, $) {
    var $body, $window, position, _debounce;
    $body = null;
    $window = $(window);
    position = function($reference, $self, _callback) {
      var left, offset, ref_height, ref_width, self_height, self_width, top;
      if (!$reference.is(':visible')) {
        return;
      }
      self_width = parseInt($self.width());
      self_height = parseInt($self.height());
      offset = $reference.offset();
      ref_height = parseInt($reference.outerHeight());
      ref_width = parseInt($reference.outerWidth());
      left = $window.width() + $window.scrollLeft() - (offset.left + self_width + 15);
      left = offset.left + Math.min(0, left);
      left = Math.max(left, offset.left + ref_width - self_width);
      top = $window.height() + $window.scrollTop() - (offset.top + ref_height + self_height + 15);
      top = top >= 0 && (offset.top + ref_height) || (offset.top - self_height - 15);
      $self.css({
        top: top,
        left: left
      });
      if ($self.is(':visible')) {
        return typeof _callback === "function" ? _callback() : void 0;
      }
    };
    _debounce = function(fn, t) {
      var _delay;
      if (t == null) {
        t = 10;
      }
      _delay = null;
      return function() {
        clearTimeout(_delay);
        return _delay = setTimeout(fn, t);
      };
    };

    /*
    	 * @param boolean repin -
     */
    return $.fn.floatable = function($reference, _callback, repin) {
      if (repin == null) {
        repin = true;
      }
      return this.each(function() {
        var $self, _position;
        $self = $(this);
        $body || ($body = $('body'));
        _position = position.bind(null, $reference, $self, _callback);
        if ($self.data('floatable')) {
          return _position();
        }
        if (repin) {
          $body.append($self.remove());
        }
        $reference.bind('click', _position);
        $window.bind({
          'resize': _position,
          'scroll': _debounce(_position)
        });
        _position();
        return $self.data('floatable', true);
      });
    };
  })(document, jQuery);

}).call(this);
